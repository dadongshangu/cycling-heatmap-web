# 🎬 测试视频生成功能 - 快速指南

## 🚀 启动服务器（3种方法）

### 方法1: 双击运行（最简单）⭐

**双击运行：`启动服务器.bat`**

脚本会自动：
- 检测Python或Node.js
- 尝试多个端口（3000, 8000, 8080, 5000）
- 显示服务器地址

### 方法2: 命令行启动

打开命令行（cmd或PowerShell），在项目目录运行：

```bash
# 使用Node.js（推荐）
npx http-server . -p 3000

# 或使用Python
python -m http.server 3000
```

### 方法3: 使用VS Code Live Server

1. 安装"Live Server"扩展
2. 右键点击 `index.html`
3. 选择 "Open with Live Server"

## ✅ 验证服务器是否运行

1. **查看命令行窗口**
   - 应该显示类似：`Starting up http-server, serving .`
   - 显示：`Available on: http://localhost:3000`

2. **在浏览器中访问**
   - 打开：`http://localhost:3000`
   - 应该能看到应用界面
   - **重要：** 地址栏必须是 `http://` 开头，不是 `file://`

## 🎯 测试视频生成步骤

### 1. 上传轨迹文件

- 点击"选择文件"按钮
- 或直接拖拽文件到上传区域
- 选择：`assets/demo/sample_beijing_ride.gpx`
- 或使用您自己的GPX文件

### 2. 生成热力图

- 点击"生成热力图"按钮
- 等待地图加载完成
- 确认热力图正常显示

### 3. 生成视频

1. **点击"生成视频"按钮**
   - 应该弹出视频配置模态框

2. **检查默认设置**
   - ✅ 开始时间：默认是"最近一年"（如果数据超过一年）
   - ✅ 结束时间：默认是最新日期
   - ✅ 可以手动调整时间范围

3. **开始生成**
   - 点击"生成"按钮
   - 应该显示进度模态框
   - 进度条会逐步增加
   - 显示处理阶段（加载库、生成帧、合成视频）

4. **完成**
   - 生成完成后自动下载视频
   - 文件名：`cycling-heatmap-video-YYYY-MM-DDTHH-MM-SS.mp4`

## ⚠️ 常见问题解决

### 问题1: "localhost 拒绝连接"

**原因：** 服务器没有启动

**解决方法：**
1. 检查命令行窗口是否还在运行
2. 重新运行 `启动服务器.bat`
3. 或手动运行：`npx http-server . -p 3000`

### 问题2: "端口被占用"

**解决方法：**
- 使用其他端口：`npx http-server . -p 3000`
- 或：`npx http-server . -p 8080`

### 问题3: "权限被拒绝"（EACCES错误）

**解决方法：**
- 使用端口3000而不是8000
- 或使用Python：`python -m http.server 3000`

### 问题4: 视频生成失败

**检查清单：**
- ✅ 确保在HTTP服务器环境下运行（`http://` 不是 `file://`）
- ✅ 检查网络连接（需要加载FFmpeg.wasm库）
- ✅ 使用现代浏览器（Chrome、Firefox、Edge最新版本）
- ✅ 确保GPX文件包含时间戳

## 📊 测试检查清单

- [ ] 服务器成功启动
- [ ] 浏览器可以访问应用（`http://localhost:3000`）
- [ ] 可以上传GPX文件
- [ ] 可以生成热力图
- [ ] "生成视频"按钮可见且可用
- [ ] 点击后显示配置模态框
- [ ] 默认时间范围是最近一年
- [ ] 可以调整时间范围
- [ ] 点击"生成"后显示进度
- [ ] 进度条正常更新
- [ ] 可以取消生成
- [ ] 生成完成后自动下载视频

## 🔍 调试技巧

1. **打开浏览器开发者工具**（按F12）
2. **查看控制台**，检查是否有错误
3. **查看网络标签**，检查资源加载
4. **检查应用状态**：
   ```javascript
   // 在浏览器控制台执行
   console.log(window.app);
   console.log(window.app.videoGenerator);
   ```

## 📝 预期结果

### ✅ 成功场景
- 视频生成完成
- 自动下载MP4文件
- 视频显示热力图逐渐增长的效果
- 文件大小合理（取决于数据量和时间范围）

### ❌ 失败场景
- 显示友好的错误提示
- 说明失败原因
- 提供解决方法

---

**提示：** 如果遇到问题，请查看浏览器控制台的错误信息，并参考 `LOCAL_SERVER_GUIDE.md` 获取更多帮助。
