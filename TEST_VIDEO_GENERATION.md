# 视频生成功能测试指南

## ✅ 代码功能测试结果

已运行自动化测试，所有代码功能正常：

- ✅ VideoGenerator类存在
- ✅ checkSupport方法存在（检测file://协议）
- ✅ loadFFmpeg方法存在（多CDN降级）
- ✅ generateVideo方法存在
- ✅ main.js集成视频生成
- ✅ file://协议检测
- ✅ 默认时间范围（最近一年）
- ✅ 示例GPX文件有效（41个轨迹点，包含时间戳）

## 🚀 手动测试步骤

### 1. 启动HTTP服务器

**方法A: 使用Node.js（推荐）**
```bash
# 在项目根目录打开命令行
npx http-server . -p 8000
```

**方法B: 使用Python**
```bash
python -m http.server 8000
```

**方法C: 使用启动脚本**
- Windows: 双击 `start-server.bat`
- Linux/Mac: 运行 `./start-server.sh`

### 2. 打开浏览器

访问：**http://localhost:8000**

**重要：** 确保地址栏显示 `http://` 而不是 `file://`

### 3. 测试基础功能

1. **上传轨迹文件**
   - 点击"选择文件"或拖拽文件
   - 选择 `assets/demo/sample_beijing_ride.gpx`
   - 或使用您自己的GPX文件

2. **生成热力图**
   - 点击"生成热力图"按钮
   - 等待地图加载完成
   - 确认热力图正常显示

### 4. 测试视频生成功能

1. **打开视频配置**
   - 点击"生成视频"按钮
   - 应该弹出视频配置模态框

2. **检查默认时间范围**
   - 开始时间应该默认是"最近一年"（如果数据超过一年）
   - 结束时间应该是最新日期
   - 可以手动调整时间范围

3. **开始生成视频**
   - 点击"生成"按钮
   - 应该显示进度模态框
   - 进度条应该逐步增加
   - 显示当前处理阶段（加载库、生成帧、合成视频等）

4. **验证功能**
   - ✅ 进度显示正常
   - ✅ 可以取消生成
   - ✅ 生成完成后自动下载视频文件

### 5. 测试错误处理

**测试file://协议检测：**
1. 直接双击打开 `index.html`（file://协议）
2. 点击"生成视频"按钮
3. 应该显示友好错误提示，说明需要在HTTP服务器环境下运行

**测试网络错误：**
1. 断开网络连接
2. 尝试生成视频
3. 应该显示网络连接错误提示

## 📋 测试检查清单

### 基础功能
- [ ] HTTP服务器可以正常启动
- [ ] 浏览器可以访问应用
- [ ] 可以上传GPX文件
- [ ] 可以生成热力图

### 视频生成功能
- [ ] "生成视频"按钮可见且可用
- [ ] 点击按钮后显示配置模态框
- [ ] 默认时间范围是最近一年
- [ ] 可以调整时间范围
- [ ] 点击"生成"后显示进度模态框
- [ ] 进度条正常更新
- [ ] 可以取消生成
- [ ] 生成完成后自动下载视频

### 错误处理
- [ ] file://协议下显示友好错误提示
- [ ] 网络错误时显示错误提示
- [ ] 无时间戳数据时显示错误提示

## 🐛 常见问题

**Q: 点击"生成视频"无反应？**
A: 
- 检查浏览器控制台是否有错误
- 确保在HTTP服务器环境下运行（不是file://）
- 检查是否已生成热力图

**Q: FFmpeg加载失败？**
A:
- 检查网络连接
- 确保使用现代浏览器（Chrome、Firefox、Edge最新版本）
- 查看浏览器控制台的详细错误信息

**Q: 视频生成很慢？**
A:
- 这是正常的，视频生成需要时间
- 数据量越大，生成时间越长
- 可以通过调整时间范围减少数据量

**Q: 生成的视频文件很大？**
A:
- 这是正常的，视频文件通常较大
- 可以通过减少时间范围或降低帧率来减小文件大小

## 📊 预期结果

### 成功场景
- 视频生成完成
- 自动下载MP4文件
- 文件名格式：`cycling-heatmap-video-YYYY-MM-DDTHH-MM-SS.mp4`
- 视频显示热力图逐渐增长的效果

### 失败场景
- 显示友好的错误提示
- 说明失败原因
- 提供解决方法

## 🔍 调试技巧

1. **打开浏览器开发者工具**（F12）
2. **查看控制台**，检查是否有错误
3. **查看网络标签**，检查资源加载情况
4. **查看应用状态**：
   ```javascript
   // 在浏览器控制台执行
   console.log(window.app);
   console.log(window.app.videoGenerator);
   ```

## 📝 测试报告模板

```
测试日期: ___________
测试环境: ___________
浏览器版本: ___________

基础功能: [ ] 通过 [ ] 失败
视频生成: [ ] 通过 [ ] 失败
错误处理: [ ] 通过 [ ] 失败

问题记录:
1. ___________
2. ___________

备注:
___________
```

---

**提示：** 如果遇到问题，请查看浏览器控制台的错误信息，并参考 `LOCAL_SERVER_GUIDE.md` 获取更多帮助。
