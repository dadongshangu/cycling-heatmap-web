# ğŸš´â€â™‚ï¸ éª‘è¡Œçƒ­åŠ›å›¾ Web åº”ç”¨ - å®Œæ•´å¼€å‘æŒ‡å—

## ğŸ“– ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
4. [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—è§£æ](#æ ¸å¿ƒæ¨¡å—è§£æ)
6. [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
7. [åŠŸèƒ½å¼€å‘æŒ‡å—](#åŠŸèƒ½å¼€å‘æŒ‡å—)
8. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
9. [éƒ¨ç½²ä¸ç»´æŠ¤](#éƒ¨ç½²ä¸ç»´æŠ¤)
10. [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªåŸºäºWebçš„éª‘è¡Œçƒ­åŠ›å›¾ç”Ÿæˆå·¥å…·ï¼Œæ¨¡ä»¿Stravaçš„çƒ­åŠ›å›¾åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ GPXè½¨è¿¹æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šåœ¨åœ°å›¾ä¸Šç”Ÿæˆç¾è§‚çš„çƒ­åŠ›å›¾ï¼Œæ˜¾ç¤ºéª‘è¡Œé¢‘ç‡å’Œè·¯çº¿å¯†åº¦ã€‚

### æ ¸å¿ƒä»·å€¼
- **éšç§ä¿æŠ¤**: æ‰€æœ‰æ•°æ®åœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨
- **å…è´¹ä½¿ç”¨**: å®Œå…¨å…è´¹ï¼Œæ— éœ€æ³¨å†Œè´¦æˆ·
- **ä¸“ä¸šæ•ˆæœ**: Stravaé£æ ¼çš„é«˜è´¨é‡çƒ­åŠ›å›¾æ¸²æŸ“
- **å¤šè®¾å¤‡æ”¯æŒ**: æ”¯æŒå„ç§GPSè®¾å¤‡å’Œåº”ç”¨çš„GPXæ–‡ä»¶

### ç›®æ ‡ç”¨æˆ·
- éª‘è¡Œçˆ±å¥½è€…
- æ•°æ®å¯è§†åŒ–çˆ±å¥½è€…
- éšç§æ„è¯†å¼ºçš„ç”¨æˆ·
- æƒ³è¦åˆ†æéª‘è¡Œæ•°æ®çš„ç”¨æˆ·

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
```
å‰ç«¯æ¡†æ¶: çº¯HTML5 + CSS3 + JavaScript (ES6+)
åœ°å›¾å¼•æ“: Leaflet.js
çƒ­åŠ›å›¾: Leaflet.heatæ’ä»¶
æ–‡ä»¶å¤„ç†: æµè§ˆå™¨åŸç”ŸFile API
æ•°æ®è§£æ: è‡ªå®šä¹‰GPXè§£æå™¨
æ ·å¼æ¡†æ¶: è‡ªå®šä¹‰CSS (å“åº”å¼è®¾è®¡)
éƒ¨ç½²å¹³å°: GitHub Pages
```

### æ¶æ„è®¾è®¡åŸåˆ™
1. **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—
2. **å“åº”å¼**: é€‚é…å„ç§å±å¹•å°ºå¯¸
3. **æ€§èƒ½ä¼˜å…ˆ**: å¤§æ–‡ä»¶å¤„ç†ä¼˜åŒ–
4. **ç”¨æˆ·å‹å¥½**: ç›´è§‚çš„æ“ä½œç•Œé¢
5. **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### æ•°æ®æµç¨‹
```
GPXæ–‡ä»¶ â†’ æ–‡ä»¶è¯»å– â†’ XMLè§£æ â†’ åæ ‡æå– â†’ æ•°æ®å¤„ç† â†’ çƒ­åŠ›å›¾æ¸²æŸ“ â†’ åœ°å›¾æ˜¾ç¤º
```

---

## ğŸ”§ åŠŸèƒ½è¯¦è§£

### æ ¸å¿ƒåŠŸèƒ½

#### 1. æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ
- **æ‹–æ‹½ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½GPXæ–‡ä»¶åˆ°æŒ‡å®šåŒºåŸŸ
- **æ‰¹é‡ä¸Šä¼ **: ä¸€æ¬¡å¯ä¸Šä¼ å¤šä¸ªGPXæ–‡ä»¶
- **æ–‡ä»¶éªŒè¯**: æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå¤§å°
- **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦

#### 2. GPXæ•°æ®è§£æ
- **XMLè§£æ**: è§£æGPXæ–‡ä»¶çš„XMLç»“æ„
- **è½¨è¿¹ç‚¹æå–**: æå–ç»çº¬åº¦åæ ‡
- **æ—¶é—´æˆ³å¤„ç†**: è§£ææ—¶é—´ä¿¡æ¯ç”¨äºè¿‡æ»¤
- **æ•°æ®æ¸…æ´—**: å»é™¤æ— æ•ˆåæ ‡ç‚¹

#### 3. çƒ­åŠ›å›¾ç”Ÿæˆ
- **å¯†åº¦è®¡ç®—**: æ ¹æ®è½¨è¿¹ç‚¹å¯†åº¦ç”Ÿæˆçƒ­åŠ›å›¾
- **é¢œè‰²æ¸å˜**: ç»¿â†’é»„â†’çº¢çš„Stravaé£æ ¼æ¸å˜
- **å¼ºåº¦è°ƒèŠ‚**: å¯è°ƒèŠ‚çƒ­åŠ›å›¾çš„å¼ºåº¦å’Œæ¨¡ç³Šåº¦
- **å®æ—¶æ¸²æŸ“**: å‚æ•°è°ƒæ•´åå®æ—¶æ›´æ–°

#### 4. åœ°å›¾ç³»ç»Ÿ
- **å¤šåœ°å›¾æº**: æ”¯æŒä¸­è‹±æ–‡åœ°å›¾åˆ‡æ¢
- **äº¤äº’æ§åˆ¶**: ç¼©æ”¾ã€å¹³ç§»ã€å…¨å±ç­‰æ“ä½œ
- **APIç®¡ç†**: å¤©åœ°å›¾APIä½¿ç”¨é‡ç›‘æ§
- **æ ·å¼åˆ‡æ¢**: æ˜æš—ä¸»é¢˜åˆ‡æ¢

#### 5. æ•°æ®ç»Ÿè®¡
- **æ–‡ä»¶ç»Ÿè®¡**: æ˜¾ç¤ºä¸Šä¼ æ–‡ä»¶æ•°é‡
- **è½¨è¿¹ç‚¹ç»Ÿè®¡**: ç»Ÿè®¡æ€»è½¨è¿¹ç‚¹æ•°
- **æ—¶é—´èŒƒå›´**: æ˜¾ç¤ºæ•°æ®çš„æ—¶é—´è·¨åº¦
- **é‡Œç¨‹ç»Ÿè®¡**: è®¡ç®—æ€»éª‘è¡Œé‡Œç¨‹

### è¾…åŠ©åŠŸèƒ½

#### 1. ç”¨æˆ·æŒ‡å¯¼
- **GPXè·å–æŒ‡å—**: è¯¦ç»†çš„è®¾å¤‡å’Œåº”ç”¨æŒ‡å—
- **ä½¿ç”¨å¸®åŠ©**: åŠŸèƒ½è¯´æ˜å’Œæ“ä½œæŒ‡å¯¼
- **è®¾å¤‡å…¼å®¹æ€§**: å„ç§GPSè®¾å¤‡çš„æ”¯æŒè¯´æ˜

#### 2. å¯¼å‡ºåŠŸèƒ½
- **å›¾ç‰‡å¯¼å‡º**: å°†çƒ­åŠ›å›¾å¯¼å‡ºä¸ºPNGå›¾ç‰‡
- **é«˜æ¸…æ¸²æŸ“**: æ”¯æŒé«˜åˆ†è¾¨ç‡å¯¼å‡º
- **æ°´å°æ·»åŠ **: å¯é€‰æ·»åŠ é¡¹ç›®æ°´å°

#### 3. ä¸ªæ€§åŒ–è®¾ç½®
- **å‚æ•°è°ƒèŠ‚**: çº¿æ¡ç²—ç»†ã€æ¨¡ç³Šåº¦ã€é€æ˜åº¦
- **æ—¶é—´è¿‡æ»¤**: æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤æ•°æ®
- **åœ°å›¾æ ·å¼**: å¤šç§åœ°å›¾æ ·å¼é€‰æ‹©

---

## ğŸ“ ä»£ç ç»“æ„

### é¡¹ç›®æ–‡ä»¶æ ‘
```
cycling-heatmap-web/
â”œâ”€â”€ index.html                    # ä¸»é¡µé¢ - åº”ç”¨å…¥å£
â”œâ”€â”€ LICENSE                       # MITå¼€æºè®¸å¯è¯
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ donate.JPEG                   # å¾®ä¿¡èµèµç 
â”œâ”€â”€ 
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css                # ä¸»æ ·å¼æ–‡ä»¶ - æ‰€æœ‰UIæ ·å¼
â”œâ”€â”€ 
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ main.js                  # ä¸»æ§åˆ¶å™¨ - åº”ç”¨é€»è¾‘
â”‚   â”œâ”€â”€ gpx-parser.js            # GPXè§£æå™¨ - æ–‡ä»¶è§£æ
â”‚   â”œâ”€â”€ heatmap-renderer.js      # çƒ­åŠ›å›¾æ¸²æŸ“å™¨ - å¯è§†åŒ–
â”‚   â””â”€â”€ map-config.js            # åœ°å›¾é…ç½® - åœ°å›¾è®¾ç½®
â”œâ”€â”€ 
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ demo/
â”‚       â”œâ”€â”€ README.md            # ç¤ºä¾‹æ–‡ä»¶è¯´æ˜
â”‚       â”œâ”€â”€ sample_beijing_ride.gpx   # åŒ—äº¬ç¤ºä¾‹è½¨è¿¹
â”‚       â””â”€â”€ sample_shanghai_ride.gpx  # ä¸Šæµ·ç¤ºä¾‹è½¨è¿¹
â”œâ”€â”€ 
â””â”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ DEVELOPER_GUIDE.md       # å¼€å‘æŒ‡å— (æœ¬æ–‡ä»¶)
    â”œâ”€â”€ DEPLOYMENT_GUIDE.md      # éƒ¨ç½²æŒ‡å—
    â”œâ”€â”€ MULTI_COMPUTER_DEVELOPMENT.md  # å¤šç”µè„‘å¼€å‘
    â””â”€â”€ ...                      # å…¶ä»–æŒ‡å—æ–‡æ¡£
```

### æ–‡ä»¶èŒè´£è¯´æ˜

#### HTMLæ–‡ä»¶
- **index.html**: åº”ç”¨çš„ä¸»é¡µé¢ï¼ŒåŒ…å«æ‰€æœ‰UIå…ƒç´ å’Œæ¨¡æ€æ¡†

#### CSSæ–‡ä»¶
- **style.css**: åŒ…å«æ‰€æœ‰æ ·å¼ï¼Œé‡‡ç”¨æ¨¡å—åŒ–ç»„ç»‡

#### JavaScriptæ–‡ä»¶
- **main.js**: åº”ç”¨ä¸»æ§åˆ¶å™¨ï¼Œåè°ƒå„ä¸ªæ¨¡å—
- **gpx-parser.js**: ä¸“é—¨å¤„ç†GPXæ–‡ä»¶è§£æ
- **heatmap-renderer.js**: è´Ÿè´£çƒ­åŠ›å›¾çš„æ¸²æŸ“å’Œæ˜¾ç¤º
- **map-config.js**: åœ°å›¾ç›¸å…³çš„é…ç½®å’Œè®¾ç½®

---

## ğŸ§© æ ¸å¿ƒæ¨¡å—è§£æ

### 1. ä¸»æ§åˆ¶å™¨ (main.js)

#### æ ¸å¿ƒèŒè´£
- åº”ç”¨åˆå§‹åŒ–
- äº‹ä»¶ç›‘å¬å’Œå¤„ç†
- æ¨¡å—é—´é€šä¿¡åè°ƒ
- UIçŠ¶æ€ç®¡ç†

#### å…³é”®å‡½æ•°
```javascript
// åº”ç”¨åˆå§‹åŒ–
function initializeApp() {
    // åˆå§‹åŒ–åœ°å›¾
    // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
    // è®¾ç½®é»˜è®¤å‚æ•°
}

// æ–‡ä»¶å¤„ç†ä¸»å‡½æ•°
function handleFiles(files) {
    // æ–‡ä»¶éªŒè¯
    // è°ƒç”¨GPXè§£æå™¨
    // æ›´æ–°UIçŠ¶æ€
}

// ç”Ÿæˆçƒ­åŠ›å›¾ä¸»å‡½æ•°
function generateHeatmap() {
    // æ”¶é›†ç”¨æˆ·å‚æ•°
    // è°ƒç”¨æ¸²æŸ“å™¨
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
}
```

#### äº‹ä»¶å¤„ç†
- æ–‡ä»¶æ‹–æ‹½å’Œé€‰æ‹©
- å‚æ•°è°ƒèŠ‚æ»‘å—
- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
- åœ°å›¾äº¤äº’äº‹ä»¶

### 2. GPXè§£æå™¨ (gpx-parser.js)

#### æ ¸å¿ƒèŒè´£
- è§£æGPXæ–‡ä»¶çš„XMLç»“æ„
- æå–è½¨è¿¹ç‚¹åæ ‡
- å¤„ç†æ—¶é—´æˆ³ä¿¡æ¯
- æ•°æ®éªŒè¯å’Œæ¸…æ´—

#### å…³é”®å‡½æ•°
```javascript
// ä¸»è§£æå‡½æ•°
function parseGPXFile(file) {
    // è¯»å–æ–‡ä»¶å†…å®¹
    // è§£æXMLç»“æ„
    // æå–è½¨è¿¹æ•°æ®
    // è¿”å›å¤„ç†åçš„æ•°æ®
}

// è½¨è¿¹ç‚¹æå–
function extractTrackPoints(gpxDoc) {
    // æŸ¥æ‰¾<trkpt>å…ƒç´ 
    // æå–lat/lonå±æ€§
    // å¤„ç†æ—¶é—´æˆ³
    // æ•°æ®éªŒè¯
}

// æ•°æ®æ¸…æ´—
function cleanTrackData(points) {
    // å»é™¤æ— æ•ˆåæ ‡
    // è¿‡æ»¤å¼‚å¸¸ç‚¹
    // æ—¶é—´èŒƒå›´è¿‡æ»¤
}
```

#### GPXæ–‡ä»¶ç»“æ„ç†è§£
```xml
<?xml version="1.0"?>
<gpx version="1.1">
  <trk>
    <name>éª‘è¡Œè½¨è¿¹</name>
    <trkseg>
      <trkpt lat="39.9042" lon="116.4074">
        <time>2024-01-01T10:00:00Z</time>
      </trkpt>
      <!-- æ›´å¤šè½¨è¿¹ç‚¹... -->
    </trkseg>
  </trk>
</gpx>
```

### 3. çƒ­åŠ›å›¾æ¸²æŸ“å™¨ (heatmap-renderer.js)

#### æ ¸å¿ƒèŒè´£
- å¤„ç†è½¨è¿¹æ•°æ®
- ç”Ÿæˆçƒ­åŠ›å›¾å›¾å±‚
- ç®¡ç†æ¸²æŸ“å‚æ•°
- æ€§èƒ½ä¼˜åŒ–

#### å…³é”®å‡½æ•°
```javascript
// æ¸²æŸ“çƒ­åŠ›å›¾
function renderHeatmap(trackData, options) {
    // æ•°æ®é¢„å¤„ç†
    // åˆ›å»ºçƒ­åŠ›å›¾å›¾å±‚
    // åº”ç”¨æ ·å¼å‚æ•°
    // æ·»åŠ åˆ°åœ°å›¾
}

// æ•°æ®å¯†åº¦å¤„ç†
function processDataDensity(points) {
    // è®¡ç®—ç‚¹å¯†åº¦
    // æƒé‡åˆ†é…
    // èšåˆç›¸è¿‘ç‚¹
}

// å‚æ•°æ›´æ–°
function updateHeatmapParams(params) {
    // æ›´æ–°æ¸²æŸ“å‚æ•°
    // é‡æ–°æ¸²æŸ“å›¾å±‚
    // ä¼˜åŒ–æ€§èƒ½
}
```

#### æ¸²æŸ“å‚æ•°
- **radius**: çƒ­åŠ›ç‚¹åŠå¾„
- **blur**: æ¨¡ç³Šç¨‹åº¦
- **opacity**: é€æ˜åº¦
- **gradient**: é¢œè‰²æ¸å˜é…ç½®

### 4. åœ°å›¾é…ç½®å™¨ (map-config.js)

#### æ ¸å¿ƒèŒè´£
- åœ°å›¾åˆå§‹åŒ–é…ç½®
- å¤šåœ°å›¾æºç®¡ç†
- APIä½¿ç”¨é‡ç›‘æ§
- åœ°å›¾æ ·å¼æ§åˆ¶

#### å…³é”®å‡½æ•°
```javascript
// åœ°å›¾åˆå§‹åŒ–
function initializeMap() {
    // åˆ›å»ºåœ°å›¾å®ä¾‹
    // è®¾ç½®é»˜è®¤è§†å›¾
    // æ·»åŠ æ§ä»¶
}

// åœ°å›¾æºåˆ‡æ¢
function switchMapSource(sourceType) {
    // ç§»é™¤å½“å‰å›¾å±‚
    // æ·»åŠ æ–°å›¾å±‚
    // æ›´æ–°UIæŒ‡ç¤ºå™¨
}

// APIä½¿ç”¨é‡ç›‘æ§
function trackAPIUsage(source, count) {
    // è®°å½•ä½¿ç”¨é‡
    // æ›´æ–°æ˜¾ç¤º
    // æ£€æŸ¥é™åˆ¶
}
```

#### æ”¯æŒçš„åœ°å›¾æº
- **CartoDB**: è‹±æ–‡åœ°å›¾ï¼Œå…è´¹æ— é™åˆ¶
- **å¤©åœ°å›¾çŸ¢é‡**: ä¸­æ–‡åœ°å›¾ï¼Œéœ€è¦API Key
- **å¤©åœ°å›¾å½±åƒ**: ä¸­æ–‡å«æ˜Ÿå›¾ï¼Œéœ€è¦API Key

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### å¿…éœ€å·¥å…·

#### 1. ä»£ç ç¼–è¾‘å™¨
**æ¨è: Visual Studio Code**
```
ä¸‹è½½åœ°å€: https://code.visualstudio.com/
æ¨èæ‰©å±•:
- Live Server (å®æ—¶é¢„è§ˆ)
- Prettier (ä»£ç æ ¼å¼åŒ–)
- GitLens (Gitå¢å¼º)
- HTML CSS Support
- JavaScript (ES6) code snippets
```

#### 2. ç‰ˆæœ¬æ§åˆ¶
**Git + GitHub Desktop**
```
Git: https://git-scm.com/
GitHub Desktop: https://desktop.github.com/
```

#### 3. æµè§ˆå™¨å¼€å‘å·¥å…·
**æ¨è: Chrome DevTools**
- è°ƒè¯•JavaScript
- æ£€æŸ¥ç½‘ç»œè¯·æ±‚
- æ€§èƒ½åˆ†æ
- ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿ

### å¼€å‘ç¯å¢ƒé…ç½®

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/dadongshangu/cycling-heatmap-web.git
cd cycling-heatmap-web
```

#### 2. æœ¬åœ°å¼€å‘æœåŠ¡å™¨
**æ–¹æ³•A: VS Code Live Server**
1. å®‰è£…Live Serveræ‰©å±•
2. å³é”®index.html â†’ "Open with Live Server"
3. è‡ªåŠ¨æ‰“å¼€ http://localhost:5500

**æ–¹æ³•B: Pythonç®€å•æœåŠ¡å™¨**
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

#### 3. è°ƒè¯•é…ç½®
**æµè§ˆå™¨å¼€å‘è€…å·¥å…·è®¾ç½®:**
- å¯ç”¨"Disable cache"
- å¼€å¯"Preserve log"
- è®¾ç½®æ–­ç‚¹è°ƒè¯•JavaScript

---

## ğŸ’» åŠŸèƒ½å¼€å‘æŒ‡å—

### å¼€å‘å·¥ä½œæµç¨‹

#### 1. åŠŸèƒ½è§„åˆ’
```
éœ€æ±‚åˆ†æ â†’ æŠ€æœ¯æ–¹æ¡ˆ â†’ æ¥å£è®¾è®¡ â†’ ç¼–ç å®ç° â†’ æµ‹è¯•éªŒè¯ â†’ æ–‡æ¡£æ›´æ–°
```

#### 2. ä»£ç è§„èŒƒ

**JavaScriptè§„èŒƒ:**
```javascript
// ä½¿ç”¨const/letï¼Œé¿å…var
const API_KEY = 'your-api-key';
let currentMap = null;

// å‡½æ•°å‘½åï¼šåŠ¨è¯+åè¯
function parseGPXFile(file) { }
function renderHeatmap(data) { }

// ç±»å‘½åï¼šé¦–å­—æ¯å¤§å†™
class GPXParser { }
class HeatmapRenderer { }

// å¸¸é‡ï¼šå…¨å¤§å†™+ä¸‹åˆ’çº¿
const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
const DEFAULT_MAP_CENTER = [39.9042, 116.4074];
```

**CSSè§„èŒƒ:**
```css
/* BEMå‘½åè§„èŒƒ */
.upload-area { }
.upload-area__content { }
.upload-area--dragover { }

/* æ¨¡å—åŒ–ç»„ç»‡ */
/* === Header === */
.header { }

/* === Upload Section === */
.upload-section { }

/* === Map Container === */
.map-container { }
```

#### 3. æ–°åŠŸèƒ½å¼€å‘æ­¥éª¤

**ç¤ºä¾‹ï¼šæ·»åŠ è½¨è¿¹ç»Ÿè®¡åŠŸèƒ½**

**Step 1: éœ€æ±‚åˆ†æ**
- ç»Ÿè®¡æ€»é‡Œç¨‹
- ç»Ÿè®¡å¹³å‡é€Ÿåº¦
- ç»Ÿè®¡çˆ¬å‡é«˜åº¦

**Step 2: è®¾è®¡æ¥å£**
```javascript
// åœ¨gpx-parser.jsä¸­æ·»åŠ 
function calculateTrackStatistics(trackPoints) {
    return {
        totalDistance: 0,
        averageSpeed: 0,
        totalElevation: 0,
        duration: 0
    };
}
```

**Step 3: å®ç°åŠŸèƒ½**
```javascript
function calculateTrackStatistics(trackPoints) {
    let totalDistance = 0;
    let totalElevation = 0;
    
    for (let i = 1; i < trackPoints.length; i++) {
        const prev = trackPoints[i - 1];
        const curr = trackPoints[i];
        
        // è®¡ç®—è·ç¦»
        const distance = calculateDistance(prev, curr);
        totalDistance += distance;
        
        // è®¡ç®—çˆ¬å‡
        if (curr.elevation > prev.elevation) {
            totalElevation += (curr.elevation - prev.elevation);
        }
    }
    
    return {
        totalDistance: totalDistance,
        totalElevation: totalElevation,
        // ... å…¶ä»–ç»Ÿè®¡
    };
}
```

**Step 4: æ›´æ–°UI**
```html
<!-- åœ¨index.htmlä¸­æ·»åŠ  -->
<div class="stat-item">
    <span class="stat-label">æ€»çˆ¬å‡:</span>
    <span class="stat-value" id="totalElevation">0 m</span>
</div>
```

**Step 5: é›†æˆåˆ°ä¸»æµç¨‹**
```javascript
// åœ¨main.jsä¸­è°ƒç”¨
function updateStatistics(allTrackData) {
    const stats = calculateTrackStatistics(allTrackData);
    document.getElementById('totalElevation').textContent = 
        `${stats.totalElevation.toFixed(0)} m`;
}
```

### å¸¸è§å¼€å‘ä»»åŠ¡

#### 1. æ·»åŠ æ–°çš„åœ°å›¾æº
```javascript
// åœ¨map-config.jsä¸­æ·»åŠ 
const mapSources = {
    // ç°æœ‰åœ°å›¾æº...
    
    'new-map-source': {
        name: 'æ–°åœ°å›¾æº',
        url: 'https://api.example.com/{z}/{x}/{y}.png',
        attribution: 'Â© æ–°åœ°å›¾æä¾›å•†',
        maxZoom: 18
    }
};
```

#### 2. æ·»åŠ æ–°çš„æ–‡ä»¶æ ¼å¼æ”¯æŒ
```javascript
// åœ¨gpx-parser.jsä¸­æ‰©å±•
function parseTrackFile(file) {
    const extension = file.name.split('.').pop().toLowerCase();
    
    switch (extension) {
        case 'gpx':
            return parseGPXFile(file);
        case 'tcx':
            return parseTCXFile(file); // æ–°å¢
        case 'fit':
            return parseFITFile(file); // æ–°å¢
        default:
            throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
    }
}
```

#### 3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§
```javascript
// å¤§æ•°æ®é‡å¤„ç†ä¼˜åŒ–
function processLargeDataset(points) {
    const BATCH_SIZE = 1000;
    const batches = [];
    
    for (let i = 0; i < points.length; i += BATCH_SIZE) {
        batches.push(points.slice(i, i + BATCH_SIZE));
    }
    
    // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é˜»å¡UI
    return new Promise((resolve) => {
        let processed = [];
        let batchIndex = 0;
        
        function processBatch() {
            if (batchIndex < batches.length) {
                processed = processed.concat(
                    processBatchData(batches[batchIndex])
                );
                batchIndex++;
                
                // ä½¿ç”¨setTimeoutè®©å‡ºæ§åˆ¶æƒ
                setTimeout(processBatch, 0);
            } else {
                resolve(processed);
            }
        }
        
        processBatch();
    });
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 1. æ–‡ä»¶åŠ è½½ä¼˜åŒ–
```html
<!-- å…³é”®CSSå†…è” -->
<style>
/* å…³é”®æ¸²æŸ“è·¯å¾„çš„CSS */
.header { display: flex; }
.main-content { display: grid; }
</style>

<!-- éå…³é”®CSSå»¶è¿ŸåŠ è½½ -->
<link rel="preload" href="css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
```

#### 2. JavaScriptä¼˜åŒ–
```javascript
// é˜²æŠ–å¤„ç†ç”¨æˆ·è¾“å…¥
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// åº”ç”¨åˆ°å‚æ•°è°ƒèŠ‚
const debouncedUpdateHeatmap = debounce(updateHeatmap, 300);
document.getElementById('radius').addEventListener('input', debouncedUpdateHeatmap);
```

#### 3. å†…å­˜ç®¡ç†
```javascript
// æ¸…ç†ä¸éœ€è¦çš„æ•°æ®
function cleanupResources() {
    // æ¸…ç†åœ°å›¾å›¾å±‚
    if (currentHeatmapLayer) {
        map.removeLayer(currentHeatmapLayer);
        currentHeatmapLayer = null;
    }
    
    // æ¸…ç†å¤§æ•°ç»„
    processedData = null;
    
    // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    if (window.gc) {
        window.gc();
    }
}
```

### æ•°æ®å¤„ç†ä¼˜åŒ–

#### 1. æ•°æ®å‹ç¼©
```javascript
// è½¨è¿¹ç‚¹ç®€åŒ–ç®—æ³•ï¼ˆDouglas-Peuckerï¼‰
function simplifyTrack(points, tolerance = 0.0001) {
    if (points.length <= 2) return points;
    
    // æ‰¾åˆ°è·ç¦»ç›´çº¿æœ€è¿œçš„ç‚¹
    let maxDistance = 0;
    let maxIndex = 0;
    
    for (let i = 1; i < points.length - 1; i++) {
        const distance = perpendicularDistance(
            points[i], 
            points[0], 
            points[points.length - 1]
        );
        
        if (distance > maxDistance) {
            maxDistance = distance;
            maxIndex = i;
        }
    }
    
    // é€’å½’ç®€åŒ–
    if (maxDistance > tolerance) {
        const left = simplifyTrack(points.slice(0, maxIndex + 1), tolerance);
        const right = simplifyTrack(points.slice(maxIndex), tolerance);
        
        return left.slice(0, -1).concat(right);
    } else {
        return [points[0], points[points.length - 1]];
    }
}
```

#### 2. ç¼“å­˜ç­–ç•¥
```javascript
// è§£æç»“æœç¼“å­˜
const parseCache = new Map();

function parseGPXFileWithCache(file) {
    const fileKey = `${file.name}_${file.size}_${file.lastModified}`;
    
    if (parseCache.has(fileKey)) {
        return Promise.resolve(parseCache.get(fileKey));
    }
    
    return parseGPXFile(file).then(result => {
        parseCache.set(fileKey, result);
        return result;
    });
}
```

---

## ğŸš€ éƒ¨ç½²ä¸ç»´æŠ¤

### GitHub Pageséƒ¨ç½²

#### 1. è‡ªåŠ¨éƒ¨ç½²é…ç½®
```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'
    
    - name: Install dependencies
      run: npm install
    
    - name: Build
      run: npm run build
    
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
```

#### 2. åŸŸåé…ç½®
```
# CNAMEæ–‡ä»¶å†…å®¹
cycling-heatmap.yourdomain.com
```

### ç›‘æ§ä¸ç»´æŠ¤

#### 1. é”™è¯¯ç›‘æ§
```javascript
// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', function(event) {
    console.error('Global error:', event.error);
    
    // å‘é€é”™è¯¯æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
    if (typeof gtag !== 'undefined') {
        gtag('event', 'exception', {
            'description': event.error.message,
            'fatal': false
        });
    }
});

// Promiseé”™è¯¯å¤„ç†
window.addEventListener('unhandledrejection', function(event) {
    console.error('Unhandled promise rejection:', event.reason);
});
```

#### 2. æ€§èƒ½ç›‘æ§
```javascript
// æ€§èƒ½æŒ‡æ ‡æ”¶é›†
function collectPerformanceMetrics() {
    if ('performance' in window) {
        const navigation = performance.getEntriesByType('navigation')[0];
        const paint = performance.getEntriesByType('paint');
        
        const metrics = {
            loadTime: navigation.loadEventEnd - navigation.loadEventStart,
            domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
            firstPaint: paint.find(p => p.name === 'first-paint')?.startTime,
            firstContentfulPaint: paint.find(p => p.name === 'first-contentful-paint')?.startTime
        };
        
        console.log('Performance metrics:', metrics);
        return metrics;
    }
}
```

---

## ğŸ”® æ‰©å±•å¼€å‘

### åŠŸèƒ½æ‰©å±•å»ºè®®

#### 1. é«˜çº§æ•°æ®åˆ†æ
```javascript
// éª‘è¡Œæ¨¡å¼è¯†åˆ«
function analyzeRidingPattern(trackPoints) {
    return {
        averageSpeed: calculateAverageSpeed(trackPoints),
        speedVariation: calculateSpeedVariation(trackPoints),
        restStops: identifyRestStops(trackPoints),
        ridingIntensity: calculateIntensity(trackPoints)
    };
}

// è·¯çº¿æ¨èç®—æ³•
function recommendRoutes(userTracks, allTracks) {
    // åŸºäºç”¨æˆ·å†å²è½¨è¿¹æ¨èç›¸ä¼¼è·¯çº¿
    // è€ƒè™‘è·ç¦»ã€éš¾åº¦ã€é£æ™¯ç­‰å› ç´ 
}
```

#### 2. ç¤¾äº¤åŠŸèƒ½
```javascript
// è½¨è¿¹åˆ†äº«
function shareTrack(trackData) {
    const shareData = {
        title: 'æˆ‘çš„éª‘è¡Œè½¨è¿¹',
        text: 'æŸ¥çœ‹æˆ‘çš„éª‘è¡Œçƒ­åŠ›å›¾',
        url: generateShareURL(trackData)
    };
    
    if (navigator.share) {
        navigator.share(shareData);
    } else {
        // é™çº§åˆ°å¤åˆ¶é“¾æ¥
        copyToClipboard(shareData.url);
    }
}

// è½¨è¿¹å¯¹æ¯”
function compareTracks(track1, track2) {
    return {
        distanceDiff: Math.abs(track1.distance - track2.distance),
        speedDiff: Math.abs(track1.avgSpeed - track2.avgSpeed),
        similarity: calculateSimilarity(track1.points, track2.points)
    };
}
```

#### 3. ç§»åŠ¨ç«¯ä¼˜åŒ–
```javascript
// PWAæ”¯æŒ
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then(registration => {
            console.log('SW registered:', registration);
        })
        .catch(error => {
            console.log('SW registration failed:', error);
        });
}

// è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ
function addTouchGestures() {
    let startX, startY;
    
    map.on('touchstart', function(e) {
        startX = e.originalEvent.touches[0].clientX;
        startY = e.originalEvent.touches[0].clientY;
    });
    
    map.on('touchend', function(e) {
        const endX = e.originalEvent.changedTouches[0].clientX;
        const endY = e.originalEvent.changedTouches[0].clientY;
        
        const deltaX = endX - startX;
        const deltaY = endY - startY;
        
        // å¤„ç†æ»‘åŠ¨æ‰‹åŠ¿
        if (Math.abs(deltaX) > 50) {
            if (deltaX > 0) {
                // å³æ»‘
            } else {
                // å·¦æ»‘
            }
        }
    });
}
```

### æŠ€æœ¯å‡çº§è·¯å¾„

#### 1. æ¡†æ¶è¿ç§»
```javascript
// è€ƒè™‘è¿ç§»åˆ°ç°ä»£æ¡†æ¶
// Reactç‰ˆæœ¬ç¤ºä¾‹
import React, { useState, useEffect } from 'react';
import { MapContainer, TileLayer } from 'react-leaflet';

function HeatmapApp() {
    const [tracks, setTracks] = useState([]);
    const [heatmapData, setHeatmapData] = useState(null);
    
    const handleFileUpload = (files) => {
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    };
    
    return (
        <div className="app">
            <FileUploader onUpload={handleFileUpload} />
            <MapContainer>
                <TileLayer />
                {heatmapData && <HeatmapLayer data={heatmapData} />}
            </MapContainer>
        </div>
    );
}
```

#### 2. åç«¯é›†æˆ
```javascript
// APIé›†æˆç¤ºä¾‹
class APIClient {
    constructor(baseURL) {
        this.baseURL = baseURL;
    }
    
    async uploadTrack(trackData) {
        const response = await fetch(`${this.baseURL}/api/tracks`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(trackData)
        });
        
        return response.json();
    }
    
    async getPublicTracks() {
        const response = await fetch(`${this.baseURL}/api/tracks/public`);
        return response.json();
    }
}
```

---

## ğŸ“š å­¦ä¹ èµ„æº

### å¿…è¯»æ–‡æ¡£
1. **Leaflet.jså®˜æ–¹æ–‡æ¡£**: https://leafletjs.com/
2. **GPXæ ¼å¼è§„èŒƒ**: https://www.topografix.com/gpx.asp
3. **Web APIæ–‡æ¡£**: https://developer.mozilla.org/

### æ¨èå­¦ä¹ è·¯å¾„
1. **JavaScriptåŸºç¡€** â†’ **DOMæ“ä½œ** â†’ **å¼‚æ­¥ç¼–ç¨‹**
2. **åœ°å›¾API** â†’ **æ•°æ®å¯è§†åŒ–** â†’ **æ€§èƒ½ä¼˜åŒ–**
3. **Gitç‰ˆæœ¬æ§åˆ¶** â†’ **é¡¹ç›®ç®¡ç†** â†’ **éƒ¨ç½²è¿ç»´**

### å¼€å‘å·¥å…·æ¨è
- **è°ƒè¯•**: Chrome DevTools, Firefox Developer Tools
- **æµ‹è¯•**: Jest, Cypress
- **æ„å»º**: Webpack, Vite
- **ä»£ç è´¨é‡**: ESLint, Prettier

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¦‚ä½•è´¡çŒ®

#### 1. æŠ¥å‘Šé—®é¢˜
- ä½¿ç”¨GitHub IssuesæŠ¥å‘Šbug
- æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤
- åŒ…å«æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯

#### 2. æäº¤ä»£ç 
```bash
# 1. Forké¡¹ç›®
# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# 3. æäº¤æ›´æ”¹
git commit -m "Add new feature: description"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/new-feature

# 5. åˆ›å»ºPull Request
```

#### 3. ä»£ç å®¡æŸ¥æ ‡å‡†
- ä»£ç é£æ ¼ä¸€è‡´
- æ·»åŠ å¿…è¦æ³¨é‡Š
- åŒ…å«æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### å¼€å‘è§„èŒƒ

#### æäº¤ä¿¡æ¯æ ¼å¼
```
type(scope): description

feat(parser): add TCX file support
fix(map): resolve tile loading issue
docs(readme): update installation guide
style(css): improve mobile responsiveness
```

#### åˆ†æ”¯ç®¡ç†
- `main`: ä¸»åˆ†æ”¯ï¼Œç¨³å®šç‰ˆæœ¬
- `develop`: å¼€å‘åˆ†æ”¯ï¼Œæœ€æ–°åŠŸèƒ½
- `feature/*`: åŠŸèƒ½åˆ†æ”¯
- `hotfix/*`: ç´§æ€¥ä¿®å¤åˆ†æ”¯

---

## ğŸ¯ æ€»ç»“

è¿™ä¸ªéª‘è¡Œçƒ­åŠ›å›¾é¡¹ç›®æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°çš„Webåº”ç”¨ã€‚é€šè¿‡è¿™ä»½æŒ‡å—ï¼Œæ–°æ‰‹å¼€å‘è€…å¯ä»¥ï¼š

1. **ç†è§£é¡¹ç›®**: äº†è§£é¡¹ç›®çš„ç›®æ ‡ã€æ¶æ„å’ŒæŠ€æœ¯æ ˆ
2. **æŒæ¡ä»£ç **: æ·±å…¥ç†è§£æ¯ä¸ªæ¨¡å—çš„èŒè´£å’Œå®ç°
3. **å‚ä¸å¼€å‘**: æŒ‰ç…§è§„èŒƒæ·»åŠ æ–°åŠŸèƒ½å’Œä¼˜åŒ–æ€§èƒ½
4. **ç‹¬ç«‹ç»´æŠ¤**: å…·å¤‡éƒ¨ç½²ã€ç›‘æ§å’Œç»´æŠ¤çš„èƒ½åŠ›

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. æ­å»ºå¼€å‘ç¯å¢ƒ
2. è¿è¡Œé¡¹ç›®å¹¶ç†Ÿæ‚‰åŠŸèƒ½
3. é˜…è¯»æ ¸å¿ƒä»£ç ï¼Œç†è§£å®ç°é€»è¾‘
4. é€‰æ‹©ä¸€ä¸ªå°åŠŸèƒ½å¼€å§‹å®è·µ
5. å‚ä¸é¡¹ç›®è´¡çŒ®ï¼Œæå‡æŠ€èƒ½

**æ¬¢è¿åŠ å…¥è¿™ä¸ªé¡¹ç›®çš„å¼€å‘ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æ›´å¥½çš„éª‘è¡Œæ•°æ®å¯è§†åŒ–å·¥å…·ï¼** ğŸš´â€â™‚ï¸âœ¨

---

*æœ€åæ›´æ–°: 2026å¹´1æœˆ*
*ä½œè€…: dadongshangu*
*é¡¹ç›®åœ°å€: https://github.com/dadongshangu/cycling-heatmap-web*
